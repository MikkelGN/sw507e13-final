\chapter{Probability updating}\label{app:direct-combination}
Normal distribution for SF and CMA are hacks, and are not listed here.
For SF, the variance is postulated to the sum of its parents' variance.
For CMA, the variance is corresponding to the moving average it is copying.

Formula for the acceleration.

\begin{equation}
	P(acc_{i+1})=\mathcal{N}(\begin{bmatrix}
	accX_{i+1} \\ accY_{i+1} \\ accZ_{i+1}
	\end{bmatrix}\sigma^2_{acc})
\end{equation}

Formula for the gyroscope.

\begin{equation}
	P(gyro_{i+1})=\mathcal{N}(\begin{bmatrix}
	gyroX_{i+1} \\ gyroY_{i+1} \\ gyroZ_{i+1}
	\end{bmatrix},\sigma^2_{gyro})
\end{equation}

Formula for aTan2.

\begin{equation}
\begin{aligned}
     P(aTan2_{i+1}) &= \mathcal{N}(G,\sigma^2_{acc})\\
     G &= \begin{bmatrix}
          atan2(\mu_{accY_{i+1}}, -\mu_{accZ_{i+1}})\\
          0\\
          atan2(\mu_{accY_{i+1}}, -\mu_{accX_{i+1}})
     \end{bmatrix}
\end{aligned}
\end{equation}

Formula for Comp.

\begin{equation}
\begin{aligned}
     P(Comp_{i+1}) &= \mathcal{N}(F*A,C)\\
     F &= \begin{bmatrix}
     \alpha & \alpha*\Delta t & 1- \alpha
     \end{bmatrix}\\
     A &= \begin{bmatrix}
          \mu_{compX_{i}} & \mu_{compY_{i}} & \mu_{compZ_{i}}\\
          \mu_{gyroX_{i+1}} & \mu_{gyroY_{i+1}} & \mu_{gyroZ_{i}}\\
          \mu_{atan2X_{i+1}} & \mu_{atan2Y_{i+1}} & \mu_{atan2Z_{i}}
     \end{bmatrix}\\
     C &= \sigma^2_{gyro_{i+1}} + \sigma^2_{atan2_{i+1}}
\end{aligned}
\end{equation}





Formula for the moving average of the acceleration.

\begin{equation}
	\begin{aligned}
		P(MA_{i+1})&=\mathcal{N}(F_{MA}*A_{MA_{i+1}},G_{MA_{i+1}}+F_{MA}*C_{MA_{i+1}}*F_{MA}^\intercal)\\
		\text{where}&\\
		F_{MA}&=\begin{bmatrix} \alpha & (1-\alpha)\end{bmatrix}\\
		A_{MA_{i+1}}&=\begin{bmatrix} \mu(SF_{i+1}) \\ \mu(MA_i)\end{bmatrix}\\	
		C_{MA_{i+1}}&=\begin{bmatrix} var(SF_{i+1}) & 0 \\ 0 & var(MA_{i}) \end{bmatrix}\\
	\end{aligned}
\end{equation}

Formula for the velocity.

\begin{equation}
	\begin{aligned}
		P(V_{i+1})&=\mathcal{N}(F_{V}*A_{V_{i+1}},G_{V_{i+1}}+F_{V}*C_{V_{i+1}}*F_{V}^\intercal)\\
		\text{where}&\\
		F_{V}&=\begin{bmatrix} \Delta t & 1 \end{bmatrix}\\
		A_{V_{i+1}}&=\begin{bmatrix} \mu(MA_{i+1}) \\ \mu(V_i)\end{bmatrix}\\	
		C_{V_{i+1}}&=\begin{bmatrix} var(MA_{i+1}) & 0 \\ 0 & var(V_{i}) \end{bmatrix}\\
	\end{aligned}
\end{equation}

Formula for the position.

\begin{equation}
	\begin{aligned}
		P(Pos_{i+1})&=\mathcal{N}(F_{Pos}*A_{Pos_{i+1}},G_{Pos_{i+1}}+F_{Pos}*C_{Pos_{i+1}}*F_{Pos}^\intercal)\\
		\text{where}&\\
		F_{Pos}&=\begin{bmatrix} \Delta t & 1 \end{bmatrix}\\
		A_{Pos_{i+1}}&=\begin{bmatrix} \mu(V_{i+1}) \\ \mu(Pos_i) \end{bmatrix}\\	
		C_{Pos_{i+1}}&=\begin{bmatrix} var(V_{i+1}) & 0 \\ 0 & var(Pos_{i})\end{bmatrix}\\
	\end{aligned}
\end{equation}